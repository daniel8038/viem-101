# Viem 方法完整参考手册

## PublicClient 方法（只读操作）

publicClient.

### 账户相关

| 方法                  | 功能描述          | 示例用途           |
| --------------------- | ----------------- | ------------------ |
| `getBalance`          | 获取账户 ETH 余额 | 查看钱包余额       |
| `getCode`             | 获取合约字节码    | 验证地址是否为合约 |
| `getStorageAt`        | 读取合约存储槽    | 访问合约内部状态   |
| `getTransactionCount` | 获取账户 nonce 值 | 计算下一个交易序号 |

### 区块相关

| 方法                       | 功能描述           | 示例用途       |
| -------------------------- | ------------------ | -------------- |
| `getBlock`                 | 获取指定区块信息   | 查看区块详情   |
| `getBlockNumber`           | 获取最新区块号     | 实时区块高度   |
| `getBlockTransactionCount` | 获取区块中交易数量 | 区块活跃度统计 |

### 交易相关

| 方法                        | 功能描述          | 示例用途         |
| --------------------------- | ----------------- | ---------------- |
| `getTransaction`            | 获取交易详情      | 查看交易状态     |
| `getTransactionReceipt`     | 获取交易回执      | 确认交易执行结果 |
| `waitForTransactionReceipt` | 等待交易确认      | 等待交易完成     |
| `estimateGas`               | 估算交易 Gas 消耗 | 预估交易费用     |

### Gas 相关

| 方法                 | 功能描述           | 示例用途           |
| -------------------- | ------------------ | ------------------ |
| `estimateGas`        | 估算 Gas 使用量    | 计算交易成本       |
| `getGasPrice`        | 获取当前 Gas 价格  | 设置合理 Gas 价格  |
| `estimateFeesPerGas` | 估算 EIP-1559 费用 | 计算优先费和基础费 |

### 合约交互

| 方法               | 功能描述         | 示例用途                   |
| ------------------ | ---------------- | -------------------------- |
| `readContract`     | 调用合约只读方法 | 查询代币余额、获取合约状态 |
| `multicall`        | 批量调用合约方法 | 一次请求获取多个数据       |
| `simulateContract` | 模拟合约调用     | 预测交易结果               |

### ENS（以太坊域名服务）

| 方法             | 功能描述           | 示例用途                |
| ---------------- | ------------------ | ----------------------- |
| `getEnsAddress`  | ENS 域名解析为地址 | `vitalik.eth` → `0x...` |
| `getEnsName`     | 地址反向解析为 ENS | `0x...` → `vitalik.eth` |
| `getEnsResolver` | 获取 ENS 解析器    | ENS 配置管理            |
| `getEnsAvatar`   | 获取 ENS 头像      | 显示用户头像            |
| `getEnsText`     | 获取 ENS 文本记录  | 获取社交媒体信息        |

### 事件和日志

| 方法                       | 功能描述       | 示例用途         |
| -------------------------- | -------------- | ---------------- |
| `getLogs`                  | 获取事件日志   | 查询历史事件     |
| `watchEvent`               | 监听实时事件   | 实时监控合约事件 |
| `watchBlocks`              | 监听新区块     | 实时区块更新     |
| `watchBlockNumber`         | 监听区块号变化 | 追踪网络状态     |
| `watchPendingTransactions` | 监听待确认交易 | MEV 机器人开发   |

### 网络状态

| 方法            | 功能描述         | 示例用途         |
| --------------- | ---------------- | ---------------- |
| `getChainId`    | 获取链 ID        | 确认当前网络     |
| `getFeeHistory` | 获取费用历史     | Gas 价格趋势分析 |
| `getProof`      | 获取 Merkle 证明 | 状态证明验证     |

---

## WalletClient 方法（写操作）

walletClient.

### 基础交易

| 方法              | 功能描述          | 示例用途           |
| ----------------- | ----------------- | ------------------ |
| `sendTransaction` | 发送原生 ETH 交易 | 转账 ETH           |
| `writeContract`   | 调用合约写入方法  | 代币转账、质押操作 |
| `deployContract`  | 部署智能合约      | 发布新合约         |

### 账户管理

| 方法               | 功能描述         | 示例用途         |
| ------------------ | ---------------- | ---------------- |
| `getAddresses`     | 获取钱包地址列表 | 多账户管理       |
| `requestAddresses` | 请求连接钱包     | 用户授权连接     |
| `switchChain`      | 切换网络         | 切换到不同区块链 |
| `addChain`         | 添加新网络       | 添加自定义网络   |

### 消息签名

| 方法              | 功能描述           | 示例用途       |
| ----------------- | ------------------ | -------------- |
| `signMessage`     | 签名文本消息       | 身份验证、登录 |
| `signTypedData`   | 签名结构化数据     | EIP-712 签名   |
| `signTransaction` | 签名交易（不发送） | 离线签名       |

### 权限管理

| 方法                 | 功能描述     | 示例用途     |
| -------------------- | ------------ | ------------ |
| `requestPermissions` | 请求钱包权限 | 获取更多权限 |
| `getPermissions`     | 获取当前权限 | 检查权限状态 |

---

## 实用工具函数

### 数据格式转换

| 函数          | 功能描述         | 示例                                        |
| ------------- | ---------------- | ------------------------------------------- |
| `formatEther` | Wei 转 ETH       | `formatEther(1000000000000000000n)` → `"1"` |
| `parseEther`  | ETH 转 Wei       | `parseEther("1")` → `1000000000000000000n`  |
| `formatUnits` | 自定义精度格式化 | `formatUnits(1000000n, 6)` → `"1"`          |
| `parseUnits`  | 自定义精度解析   | `parseUnits("1", 6)` → `1000000n`           |
| `formatGwei`  | Wei 转 Gwei      | `formatGwei(1000000000n)` → `"1"`           |
| `parseGwei`   | Gwei 转 Wei      | `parseGwei("1")` → `1000000000n`            |

### 地址处理

| 函数             | 功能描述       | 示例                                |
| ---------------- | -------------- | ----------------------------------- |
| `isAddress`      | 验证地址格式   | `isAddress("0x...")` → `true/false` |
| `isAddressEqual` | 比较两个地址   | `isAddressEqual(addr1, addr2)`      |
| `getAddress`     | 标准化地址格式 | 统一地址大小写                      |

### 哈希和编码

| 函数                 | 功能描述         | 示例用途     |
| -------------------- | ---------------- | ------------ |
| `keccak256`          | Keccak-256 哈希  | 计算数据哈希 |
| `toHex`              | 转换为十六进制   | 数据编码     |
| `fromHex`            | 从十六进制解码   | 数据解码     |
| `encodeFunctionData` | 编码函数调用数据 | 构造交易数据 |
| `decodeFunctionData` | 解码函数调用数据 | 解析交易数据 |

### 签名验证

| 函数              | 功能描述           | 示例用途     |
| ----------------- | ------------------ | ------------ |
| `verifyMessage`   | 验证消息签名       | 身份验证     |
| `verifyTypedData` | 验证结构化数据签名 | EIP-712 验证 |
| `recoverAddress`  | 从签名恢复地址     | 签名者识别   |
